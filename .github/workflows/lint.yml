name: Lint TaggerScript

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  lint:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check line endings
        run: |
          if file naming.pts | grep -q "CRLF"; then
            echo "ERROR: File has CRLF line endings, should be LF"
            exit 1
          else
            echo "✓ Line endings are correct (LF)"
          fi

      - name: Check for trailing whitespace
        run: |
          if grep -n "[[:space:]]$" naming.pts; then
            echo "WARNING: Trailing whitespace found on lines above"
          else
            echo "✓ No trailing whitespace"
          fi

      - name: Check indentation consistency
        run: |
          python3 -c "
          import sys

          with open('naming.pts', 'r') as f:
              lines = f.readlines()

          inconsistent = []
          for i, line in enumerate(lines, 1):
              if line.startswith(' ') and not line.startswith('  '):
                  # Check if it's using odd number of spaces
                  spaces = len(line) - len(line.lstrip(' '))
                  if spaces % 2 != 0:
                      inconsistent.append(f'Line {i}: {spaces} spaces (not multiple of 2)')

          if inconsistent:
              print('WARNING: Inconsistent indentation found:')
              for issue in inconsistent:
                  print(f'  {issue}')
          else:
              print('✓ Indentation is consistent')
          "

      - name: Check for TODO/FIXME comments
        run: |
          if grep -n "TODO\|FIXME\|XXX" naming.pts; then
            echo "INFO: TODO/FIXME comments found above"
          else
            echo "✓ No TODO/FIXME comments"
          fi

      - name: Validate variable naming conventions
        run: |
          python3 -c "
          import re

          with open('naming.pts', 'r') as f:
              content = f.read()

          # Find all variable assignments
          var_pattern = r'\\\$set\(([a-zA-Z_][a-zA-Z0-9_]*)'
          variables = re.findall(var_pattern, content)

          issues = []
          for var in variables:
              # Check if temporary variables use underscore prefix
              if var.startswith('_') and var.isupper():
                  issues.append(f'WARNING: Variable {var} uses uppercase with underscore prefix')
              # Check for camelCase vs snake_case consistency
              if var[0].islower() and var != var.lower() and '_' not in var:
                  # This is camelCase
                  pass  # Could enforce snake_case here if desired

          if issues:
              print('\\n'.join(issues))
          else:
              print('✓ Variable naming conventions look good')
          "
